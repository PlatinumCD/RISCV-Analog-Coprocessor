# Image Args
ARG DOCKERHUB_USER
ARG RELEASE
ARG LLVM_RISCV_MUSL_IMAGE_NAME
ARG SST_CROSSSIM_IMAGE_NAME

FROM ${DOCKERHUB_USER}/${LLVM_RISCV_MUSL_IMAGE_NAME}:${RELEASE} as compiler_stage
FROM ${DOCKERHUB_USER}/${SST_CROSSSIM_IMAGE_NAME}:${RELEASE}

ARG BUILD_DEST

COPY --from=compiler_stage ${BUILD_DEST} ${BUILD_DEST}

ARG ANALOG_LIB_GIT
ARG ANALOG_LIB_BRANCH

ENV PATH="${PATH}:${BUILD_DEST}/llvm/bin"
ENV BUILD_SRC=${BUILD_SRC}
ENV BUILD_DEST=${BUILD_DEST}

RUN git clone -b ${ANALOG_LIB_BRANCH} ${ANALOG_LIB_GIT} ${BUILD_DEST}/analog
# && \
#    mv ${BUILD_DEST}/analog/analog /usr/lib/analog

WORKDIR /local/src
